---
description: Your application incorporates optimal design and usage of the tablet pen by sending both Microsoft Windows mouse messages and system events.
ms.assetid: ccd45b68-f037-43da-a7d0-1df9439afd11
title: System Events and Mouse Messages
ms.topic: article
ms.date: 05/31/2018
---

# System Events and Mouse Messages

Your application incorporates optimal design and usage of the tablet pen by sending both Microsoft Windows mouse messages and system events. Applications receive both sets of events for each pen movement or action. The application then chooses the appropriate event to use based on the context of the action. Windows mouse messages work well for pointing and selecting activities, and you should use them for activities that involve interaction with user interface (UI) elements. Pen events work well for real-time ink application, pen actions, and handwriting.

> [!Note]  
> Both pen events and mouse messages are sent to an application, regardless of whether the pen or the mouse is used.

 

## Distinguishing Pen Input from Mouse and Touch

When your application receives a mouse message (such as WM\_LBUTTONDOWN), it may call the [**GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) function to evaluate whether the message originated from a pen or a mouse device.

The value returned from [**GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) needs to be mask-checked against 0xFFFFFF00, and then compared with 0xFF515700. The following definitions may make this clearer:


```C++
#define MI_WP_SIGNATURE<entity type="nbsp"/> 0xFF515700
#define SIGNATURE_MASK<entity type="nbsp"/><entity type="nbsp"/> 0xFFFFFF00
#define IsPenEvent(dw)<entity type="nbsp"/><entity type="nbsp"/> (((dw) & SIGNATURE_MASK) == MI_WP_SIGNATURE
```



If the comparison is true, then this mouse message was generated by a Tablet PC pen or touch screen. In all other cases, you can assume that this message was generated by a mouse device.

The lower 8 bits returned from [**GetMessageExtraInfo**](/windows/win32/api/winuser/nf-winuser-getmessageextrainfo) are variable. Of those bits, 7 (the lower 7, masked by 0x7F) are used to represent the cursor ID, zero for the mouse or a variable value for the pen ID. Additionally, in Windows Vista, the eighth bit, masked by 0x80, is used to differentiate touch input from pen input (0 = pen, 1 = touch).

## Supported System Gestures

The following table lists system gestures currently included in Windows XP Tablet PC Edition, details the corresponding pen actions and system events, and shows how they relate to traditional mouse actions.



| Pen gesture                                  | Mouse action                                                    | Pen gesture description                                                                                                                                                                                                             | Event messages                                                                                                                       | Mouse messages                                                                                                                        | Behaviors in Windows-based applications                                                                                                                                          |
|----------------------------------------------|-----------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Tap<br/>                               | Left-click<br/>                                           | Tap the screen once with the pen.<br/>                                                                                                                                                                                        | ISG\_TAP sent when pen is lifted.<br/>                                                                                         | WM\_LBUTTONDOWN and WM\_LBUTTONUP sent when pen lifted.<br/>                                                                    | Choose command from menu or toolbar, take action if command chosen, set insertion point (IP), show selection feedback.<br/>                                                |
| Double-tap<br/>                        | Double-click<br/>                                         | Tap screen twice in quick succession.<br/>                                                                                                                                                                                    | ISG\_DOUBLETAP sent on second tap (down). ISG\_TAP event sent on the first tap.<br/>                                           | WM\_LBUTTONDBLCLK sent on second tap (down). WM\_LBUTTONDOWN and WM\_LBUTTONUP sent on first tap (up) as for a single tap.<br/> | Select word, open file or folder.<br/>                                                                                                                                     |
| Press and hold<br/>                    | Right-click<br/>                                          | Tap the screen and hold until a mouse icon appears, and then lift the pen to display a shortcut menu. An application could choose to perform an action different from showing a right-click menu when the pen is lifted.<br/> | ISG\_HOLDENTER sent when the pen has been down long enough. ISG\_RIGHTTAP sent when pen is lifted and right-click occurs.<br/> | WM\_RBUTTONDOWN and WM\_RBUTTONUP sent when right click occurs (when pen is lifted).<br/>                                       | Show shortcut menu.<br/>                                                                                                                                                   |
| Hold-through<br/>                      | Left-click<br/>                                           | Tap the screen and hold until the mouse icon appears and disappears. Users are likely to do this when they accident-tally press and hold and want to revert to just tap.<br/>                                                 | ISG\_TAP sent when pen is lifted.<br/>                                                                                         | WM\_LBUTTONDOWN and WM\_LBUTTONUP sent when pen is lifted.<br/>                                                                 | Left-click for a long time. No mouse equivalent exists. This is a fallback for when a user performs press-and-hold for a long time. The event reverts to being a tap.<br/> |
| Drag<br/>                              | Left-drag<br/>                                            | Tap the screen to select the object that is to be moved, and then drag after the object is selected.<br/>                                                                                                                     | ISG\_DRAG sent when drag starts.<br/>                                                                                          | WM\_LBUTTONDOWN sent when drag starts, followed by a series of mouse move messages, and followed by a WM\_LBUTTONUP event.<br/> | Drag-select, as in Microsoft Word when starting with an IP; select multiple words; drag, as when dragging an object in Windows; scrolling.<br/>                            |
| Press and hold followed by a drag<br/> | Right-drag<br/>                                           | Tap the screen to select the object that is to be moved. Hold until the mouse icon appears, and then drag to move the object. Lift the pen to display a shortcut menu.<br/>                                                   | ISG\_HOLDENTER sent when pen has been down for some time. ISG\_RIGHTDRAG sent when drag starts.<br/>                           | WM\_RBUTTONDOWN sent when drag starts, followed by a series of mouse move messages, followed by a WM\_RBUTTONUP event.<br/>     | Drag, as when dragging an object or selection followed by a context menu.<br/>                                                                                             |
| Pen hover<br/>                         | Mouse hover<br/>                                          | Hold the pen steady at a small distance from the screen.<br/>                                                                                                                                                                 | ISG\_HOVERENTER event sent initially. When hover interval is completed, ISG\_HOVERLEAVEis sent.<br/>                           | No mouse message equivalent.<br/>                                                                                               | Show ToolTip, roll-over effects, and other mouse hover behaviors.<br/>                                                                                                     |
| In-air shake<br/>                      | Show **Tablet PC Input Panel**. No mouse equivalent.<br/> | Move the pen quickly from side to side, holding the tip above, but within range of, the screen.<br/>                                                                                                                          | Event is not passed to the application.<br/>                                                                                   | No mouse message equivalent.<br/>                                                                                               | New, specific to Tablet PC.<br/>                                                                                                                                           |



 

## Specifying Stylus and Touch Interactions

By default, your window will receive all system gesture events and use the default interaction model. Some pieces of this model may interfere with your application, so you may disable them selectively by responding to the [**WM\_TABLET\_QUERYSYSTEMGESTURESTATUS Message**](wm-tablet-querysystemgesturestatus-message.md) in your WndProc.

 

 
