---
title: Bluetooth and WSAQUERYSET for Set Service
description: Using the WSAQUERYSET structure with the WSASetService function to register or remove service instances in the Bluetooth namespace (NS\_BTH).
ms.assetid: e582156d-a298-4d9b-8ed1-4c558fa4f203
keywords:
- Bluetooth and WSAQUERYSET for Set Service Bluetooth
- WSAQUERYSET Bluetooth , for set service
ms.topic: article
ms.date: 05/31/2018
---

# Bluetooth and WSAQUERYSET for Set Service

Bluetooth uses the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure to facilitate the discovery of devices and services in the Bluetooth namespace, NS\_BTH.

The [**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea) function uses the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure to register or remove service instances in the Bluetooth namespace. The following table lists member values in the **WSAQUERYSET** structure.

| Member                      | Required value (input)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | Output                                                                                                                                                                                                                                                                                                                                                                                                                           |
|-----------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **dwSize**                  | Must be set to **sizeof**([**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)). Used as a versioning mechanism.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **dwOutputFlags**           | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpszServiceInstanceName** | Optional, but recommended. Used to construct the Bluetooth ServiceName attribute.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpServiceClassId**        | Required. GUID corresponding to the service class. This value should correspond to a GUID from the Bluetooth Assigned Numbers document for known profiles, or a unique application-generated UUID for applications that are not profile based. Used to construct a ServiceClassIdList attribute sequence with this as its only member.                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpVersion**               | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpszComment**             | Optional. Used to construct the Bluetooth ServiceDescription attribute.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **dwNameSpace**             | Namespace in which to constrain the service. Must be NS\_BTH.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpNSProviderId**          | Not required.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpszContext**             | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **dwNumberOfProtocols**     | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpafpProtocols**          | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpszQueryString**         | Not used.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **dwNumberOfCsAddrs**       | Number of addresses to register. Must be 1.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpcsaBuffer**             | Required if **lpBlob** has not been populated with a raw SDP stream. Pointer to a [**CSADDR\_INFO**](/windows/desktop/api/nspapi/ns-nspapi-csaddr_info) structure with its **LocalAddr.lpSockaddr** member pointing to the [**SOCKADDR\_BTH**](/windows/desktop/api/Ws2bth/ns-ws2bth-sockaddr_bth) where the server is listening for connections. The [**getsockname**](/windows/desktop/api/winsock/nf-winsock-getsockname) function can be used to return the **SOCKADDR\_BTH** structure for a bound socket. Information in the **lpcsaBuffer** member is used by the system to construct the Bluetooth ProtocolDescriptorList SDP attribute. The protocol and port provided in **lpcsaBuffer** must be unique (not previously registered), and are used to index the record for subsequent calls to delete. Used to construct the Bluetooth ProtocolDescriptorList attribute of the SDP record. | None.                                                                                                                                                                                                                                                                                                                                                                                                                            |
| **lpBlob**                  | Optional. Pointer to a [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob) structure that points to a [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structure, enabling the client to provide a Bluetooth-specific structure containing a binary SDP record constructed by the application. If **lpBlob** is provided to the [**WSASetService**](/windows/desktop/api/winsock2/nf-winsock2-wsasetservicea) function, all other members of the [**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw) structure except **dwSize** and **dwNameSpace** are ignored. See [Bluetooth and BLOB](bluetooth-and-blob.md) for more information. Submitting a binary SDP record is necessary in many cases, because a limited number of SDP attributes can be converted from the **WSAQUERYSET** structure, and strings are converted only to default language UTF-8 encoding.           | If the optional [**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob) and [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structures have been provided on input, along with the ULONG version and HANDLE values which must be pointed to by **BTH\_SET\_SERVICE**, the version is updated to contain the BTH\_SDP\_VERSION value for the Bluetooth Windows Sockets provider, and the handle is provided, which is required to subsequently delete the record. |



 

> [!Note]  
> To remove a service, the only required members in the [**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service) structure are the **pSdpVersion** and **pRecordHandle** members.

 

## Related topics

<dl> <dt>

[Bluetooth and WSAQUERYSET for Device Inquiry](bluetooth-and-wsaqueryset-for-device-inquiry.md)
</dt> <dt>

[Bluetooth and WSAQUERYSET for Service Inquiry](bluetooth-and-wsaqueryset-for-service-inquiry.md)
</dt> <dt>

[Bluetooth and BLOB](bluetooth-and-blob.md)
</dt> <dt>

[Bluetooth and WSASetService](bluetooth-and-wsasetservice.md)
</dt> <dt>

[**BLOB**](/windows/desktop/api/nspapi/ns-nspapi-blob)
</dt> <dt>

[**BTH\_SET\_SERVICE**](/windows/desktop/api/Ws2bth/ns-ws2bth-bth_set_service)
</dt> <dt>

[**CSADDR\_INFO**](/windows/desktop/api/nspapi/ns-nspapi-csaddr_info)
</dt> <dt>

[**getsockname**](/windows/desktop/api/winsock/nf-winsock-getsockname)
</dt> <dt>

[**SOCKADDR\_BTH**](/windows/desktop/api/Ws2bth/ns-ws2bth-sockaddr_bth)
</dt> <dt>

[**WSAQUERYSET**](/windows/desktop/api/winsock2/ns-winsock2-wsaquerysetw)
</dt> <dt>

[Windows Sockets](/windows/desktop/WinSock/windows-sockets-start-page-2)
</dt> </dl>

 

 