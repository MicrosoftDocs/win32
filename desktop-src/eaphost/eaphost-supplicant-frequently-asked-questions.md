---
title: EAPHost Supplicant Frequently Asked Questions
description: This topic provides answers to commonly-asked questions about the EAPHost Supplicant API.
ms.assetid: bf8db711-386e-47c2-be47-4cfd6c4d8d9e
ms.topic: article
ms.date: 05/31/2018
---

# EAPHost Supplicant Frequently Asked Questions

This topic provides answers to commonly-asked questions about the EAPHost Supplicant API.

### EAPHost Supplicant Frequently Asked Questions



<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>Question</th>
<th>Answer</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Why do I need to call [<strong>EapHostPeerInitialize</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerinitialize) and [<strong>EapHostPeerUninitialize</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeeruninitialize)?</td>
<td>[<strong>EapHostPeerInitialize</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerinitialize) and [<strong>EapHostPeerUninitialize</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeeruninitialize) initialize and uninitialize the COM environment used for interprocess communication (IPC) between a supplicant and EAPHost.</td>
</tr>
<tr class="even">
<td>Which functions must be invoked on threads that have COM initialized for [Single Threaded Apartment](/previous-versions/ms810413(v=msdn.10)) (STA)?</td>
<td>[<strong>EapHostPeerInvokeConfigUI</strong>](/previous-versions/windows/desktop/api/eaphostpeerconfigapis/nf-eaphostpeerconfigapis-eaphostpeerinvokeconfigui), [<strong>EapHostPeerInvokeInteractiveUI</strong>](/previous-versions/windows/desktop/api/eaphostpeerconfigapis/nf-eaphostpeerconfigapis-eaphostpeerinvokeinteractiveui), and [<strong>EapHostAuthenticatorInvokeConfigUI</strong>](/previous-versions/windows/desktop/api/eapmethodauthenticatorapis/nf-eapmethodauthenticatorapis-eapmethodauthenticatorinvokeconfigui) must be called on threads that have COM initialized for STA. This can be achieved by calling COM API [<strong>CoInitialize</strong>](/windows/win32/api/objbase/nf-objbase-coinitialize); when the supplicant has finished with the STA thread [<strong>CoUninitialize</strong>](/windows/win32/api/combaseapi/nf-combaseapi-couninitialize) must be called before exiting.</td>
</tr>
<tr class="odd">
<td>How does EAPHost export keying material?</td>
<td>EAPHost EAP methods export Master Session Keys (MSKs)in the form of Microsoft Point-to-Point Encryption (MPPE) keys to the supplicants. Additional keying material, such as Pairwise Master Keys (PMKs) can be generated by the supplicant using the MSK. For the methods to generate any other keys during authentication, the methods can provide those keys as vendor-specific attributes to the supplicants.</td>
</tr>
<tr class="even">
<td>What is an Extended Master Session Key (EMSK)?</td>
<td>EMSK is additional keying material that is exported by the EAP method. EMSK is at least 64 octets in length. EMSK is shared between the EAP client and server, but is not shared with the authenticator or any other third party. Currently, EMSK is reserved for future use. For more information, see [Extensible Authentication Protocol EAP) Method Requirements for Wireless LANs](https://go.microsoft.com/fwlink/p/?linkid=84064).<br/></td>
</tr>
<tr class="odd">
<td>When does a method consume or generate an attribute?</td>
<td>If an EAP method generates attributes or EMSK, then the supplicant will consume attributes. Typically, attributes that are consumed by supplicants are keys. The attributes consumed are <strong>eatPeerId</strong>, <strong>eatServerId</strong>, <strong>eatMethodId</strong>, <strong>eatEMSK</strong>, and <strong>eatCredentialsChanged</strong>. For more information, see [<strong>EAP_ATTRIBUTE_TYPE</strong>](/windows/desktop/api/eaptypes/ne-eaptypes-eap_attribute_type). An EAP method can export additional application-specific EMSK material such as:
<ul>
<li>Session ID</li>
<li>[Network Access Protection](/windows/desktop/NAP/network-access-protection-start-page) (NAP)</li>
</ul>
<br/></td>
</tr>
<tr class="even">
<td>Which attributes does [802.1X](/previous-versions/windows/embedded/ms890287(v=msdn.10)) consume?</td>
<td>The native wireless [802.1X](/previous-versions/windows/embedded/ms890287(v=msdn.10)) supplicant will consume the following EAPHost authentication attributes:
<ul>
<li>Change password notification</li>
<li>Microsoft Point-to-Point Encryption (MPPE) send/receive keys. VendorId/VendorType = 331/16 and 311/1</li>
</ul>
MPPE keys are keys generated at the end of successful authentication, by both peer and authenticator. These keys are used by [802.1X](/previous-versions/windows/embedded/ms890287(v=msdn.10)) and the network access server (NAS) to encrypt and decrypt packets that are sent and received.<br/></td>
</tr>
<tr class="odd">
<td>What's the purpose of the EAP_PEER_FLAG_GUEST_ACCESS flag in EAPHost?</td>
<td>When this flag is set in [<strong>EAPHostPeerBeginSession</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession), EAPHost interprets this as a request for guest authorization and returns a <strong>NULL</strong> identity response that is then passed to the supplicant and returned to the EAP Server.</td>
</tr>
<tr class="even">
<td>How does the supplicant request machine authentication?</td>
<td>Machine authentication is requested by setting the [<strong>EAP_FLAG_MACHINE_AUTH</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) flag.</td>
</tr>
<tr class="odd">
<td>How does the supplicant request user authentication?</td>
<td>User authentication is requested by not setting the [<strong>EAP_FLAG_MACHINE_AUTH</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) flag.</td>
</tr>
<tr class="even">
<td>When do I use [<strong>EapHostPeerFreeErrorMemory</strong>](/previous-versions/windows/desktop/api/eaphostpeerconfigapis/nf-eaphostpeerconfigapis-eaphostpeerfreeerrormemory) instead of the [<strong>EapHostFreeEapError</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerfreeeaperror) function?</td>
<td>The [<strong>EapHostPeerFreeErrorMemory</strong>](/previous-versions/windows/desktop/api/eaphostpeerconfigapis/nf-eaphostpeerconfigapis-eaphostpeerfreeerrormemory) function is used only for freeing [<strong>EAP_ERROR</strong>](/windows/desktop/api/eaptypes/ns-eaptypes-eap_error) structures returned by EAPHost configuration APIs. EAPHost configuration APIs are defined in EapHostPeerConfigApis.h. In contrast, the [<strong>EapHostPeerFreeEapError</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerfreeeaperror) function is used for freeing <strong>EAP_ERROR</strong> structures returned by EAPHost run-time APIs. EAPHost run-time APIs are defined in EapPApis.h. Never use the run-time version of the API with the configuration version of the APIs; to do so could produce unexpected results.<br/></td>
</tr>
<tr class="odd">
<td>I have implemented my UI in the same thread that I use to process an EAP authentication session on the supplicant. After I have raised an interactive user interface dialog box to obtain credentials or other user input data, the next call by the EAPHost to an EAP peer method fails with <strong>ERROR_OBJECT_DISCONNECTED</strong>. Why has this occurred, and how do I address it?</td>
<td>While the EAPHost client-side APIs are all C style APIs, these C APIs are just wrappers of corresponding COM APIs. The C style APIs run in a multithreaded COM environment. UI code usually runs in the apartment thread model. Because the two thread models conflict with one another, do not run the UI code in the same thread that processes EAP authentications.</td>
</tr>
<tr class="even">
<td>Why does the [<strong>EapHostPeerBeginSession</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) API take a [<em>NotificationHandler</em>](/previous-versions/windows/desktop/api) callback function pointer as a parameter?</td>
<td>[<em>NotificationHandler</em>](/previous-versions/windows/desktop/api) is the mechanism by which a supplicant is notified that it must re-authenticate. There are various scenarios where the supplicant is required to re-authenticate, including authentication with [Network Access Protection](/windows/desktop/NAP/network-access-protection-start-page) (NAP).</td>
</tr>
<tr class="odd">
<td>What is the purpose of the <em>pConnectionId</em> parameter in the [<strong>EapHostPeerBeginSession</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeerbeginsession) API?</td>
<td><em>pConnectionId</em> is a pointer to a supplicant-defined GUID value used to identify a network connection that belongs to the supplicant. When the [<em>NotificationHandler</em>](/previous-versions/windows/desktop/api) callback function is called, this GUID is passed to identify the network connection that the supplicant will use for re-authentication requests.</td>
</tr>
<tr class="even">
<td>How do I know if there is a change in quarantine state?</td>
<td>The user will receive visual notification of a change in quarantine state only if there is at least one Network Access Protection (NAP) quarantine enforcement client (QEC) registered interface in the system. If so, when re-authentication is attempted the user will be notified of a quarantine state change via a pop-up window.</td>
</tr>
<tr class="odd">
<td>How do I know if there is a NAP QEC registered interface in the system?</td>
<td>Open an elevated window, and run the following netsh command: &quot;netsh nap client show state&quot;. For more information, see [Netsh Commands](/previous-versions/windows/it-pro/windows-server-2003/cc779693(v=ws.10)).</td>
</tr>
<tr class="even">
<td>If the supplicant re-authenticates, what connection ID should the QEC use during re-authentication?</td>
<td>The QEC should use the same connection ID that was used for the previous session.</td>
</tr>
<tr class="odd">
<td>There is only one EAPHost supplicant method available to display user interface (UI) dialog boxes, but EAP methods have several types of UI-specific calls. What method should the supplicant call when it obtains the <strong>EapHostPeerResponseInvokeUI</strong> action code, indicating that the supplicant must display a UI dialog box?</td>
<td>No action is required by the user because EAPHost knows which method function to call. For instance, when action code <strong>EapHostPeerResponseInvokeUI</strong> is returned, the supplicant calls these three functions in the following order: [<strong>EapHostPeerGetUIContext</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeergetuicontext), [<strong>EapHostPeerInvokeInteractiveUI</strong>](/previous-versions/windows/desktop/api/eaphostpeerconfigapis/nf-eaphostpeerconfigapis-eaphostpeerinvokeinteractiveui), and [<strong>EapHostPeerSetUIContext</strong>](/previous-versions/windows/desktop/api/eappapis/nf-eappapis-eaphostpeersetuicontext).</td>
</tr>
<tr class="even">
<td>What is the difference between a credentials BLOB and a configuration BLOB?</td>
<td>The credentials BLOB contains only user data such as user name, password, and PIN. The configuration BLOB contains the settings that control the behavior of the method.</td>
</tr>
<tr class="odd">
<td>Can I enable tracing on the EAPHost client side?</td>
<td>Yes. For more information, see [Enabling Tracing](enabling-tracing.md).</td>
</tr>
</tbody>
</table>



 

## Related topics

<dl> <dt>

[EAPHost Supplicant API Reference](eap-host-supplicant-api-reference.md)
</dt> <dt>

[EAPHost General FAQs](general-frequently-asked-questions.md)
</dt> <dt>

[EAPHost Method FAQs](eap-method-frequently-asked-questions.md)
</dt> <dt>

[EAPHost Development FAQs](eaphost-development-frequently-asked-questions.md)
</dt> </dl>

