---
title: Modifying Wizard-generated Code
description: Modifying Wizard-generated Code
ms.assetid: 391a7773-c3e2-499a-bb63-e5934537d963
keywords:
- Windows Media Player Mobile,plug-ins
- Windows Media Player Mobile,user interface plug-ins
- Windows Media Player Mobile plug-ins
- plug-ins,user interface
- plug-ins,Windows Media Player Mobile
- user interface plug-ins,Windows Media Player Mobile
- UI plug-ins,Windows Media Player Mobile
ms.topic: article
ms.date: 05/31/2018
---

# Modifying Wizard-generated Code

There are several places in the wizard-generated plug-in code that you must modify before your plug-in will work with Windows Media Player 10 Mobile. The code you must modify is bold in the following examples.

## Changes to wmpplug.h

ANSI methods are not supported on devices running Windows CE, so you must modify the following ANSI method generated by the wizard in wmpplug.h:


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageA( "WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



Modify it as shown in the following so that it becomes a Unicode method:


```C++
return( ::PostMessage( HWND_BROADCAST, ::RegisterWindowMessageW( L"WMPlayer_PluginAddRemove" ), 0, 0 ) );
```



## Changes to NetworkPlugin.h

Find the following code in NetworkPlugin.h:


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    COM_INTERFACE(IWMPPluginUI)
END_COM_MAP()
```



Modify the code so that it looks like this:


```C++
BEGIN_COM_MAP(CNetworkPlugin)
    
COM_INTERFACE_ENTRY_IID(__uuidof(IWMPPluginUI), IWMPPluginUI)
END_COM_MAP()
```



## Changes to NetworkPlugindll.cpp

Find the **DllMain** function in NetworkPlugindll.cpp:


```C++
extern "C" BOOL WINAPI DllMain(HINSTANCE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, hInstance);
        DisableThreadLibraryCalls(hInstance);
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



Modify the code so that it looks like this:


```C++
extern "C" BOOL WINAPI DllMain(HANDLE hInstance, DWORD dwReason, LPVOID /*lpReserved*/)
{
    if (dwReason == DLL_PROCESS_ATTACH)
    {
        _Module.Init(ObjectMap, (HINSTANCE)hInstance);
#ifndef UNDER_CE
        DisableThreadLibraryCalls((HINSTANCE)hInstance);
#endif
    }
    else if (dwReason == DLL_PROCESS_DETACH)
        _Module.Term();
    return TRUE;    // ok
}
```



## Changes to NetworkPlugin.cpp

Find the following code in NetworkPlugin.cpp:


```C++
hr = m_spCore->QueryInterface(&spConnectionContainer);
```



Modify the code so that it looks like this:


```C++
hr = m_spCore->QueryInterface(__uuidof(IConnectionPointContainer), (void**)&spConnectionContainer);
```



## Change the Threading Model

Unlike ATL for Windows, ATL for Windows CE does not support the apartment threading model because the apartment model requires more memory resources than the single threading and free threading models. Therefore, you must find all instances of apartment threading in StdAfx.h and NetworkPlugin.rgs and change them to indicate free threading.

Also, you can only call the Windows Media Player 10 Mobile control from the thread on which it was created.

## Build and Test the Project

After making these changes outlined here, you can build your project to verify that it compiles before you add any custom code.

1.  Set the active project configuration to Win32 (WCE ARMV4) Debug or Win32 (WCE ARMV4) Release.
2.  Set the active platform to Pocket PC 2003.
3.  Click the **Build** menu item, and then select **Build NetworkPlugin.dll**. It should compile, download, and register itself on your device.

## Related topics

<dl> <dt>

[**Creating a User Interface Plug-in for Windows Media Player 10 Mobile**](creating-a-user-interface-plug-in-for-windows-media-player-10-mobile.md)
</dt> </dl>

 

 




