---
description: How to generate, retrieve, and export RSA/Schannel keys.
ms.assetid: 3069232f-d016-4973-ae39-89b0e2a03cd7
title: RSA/Schannel Keys
ms.topic: article
ms.date: 05/31/2018
---

# RSA/Schannel Keys

## Generating and Retrieving RSA/Schannel Keys

[*RSA*](../secgloss/r-gly.md)/[*Schannel*](../secgloss/s-gly.md) keys can be generated by calling the [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey) function. The call to **CryptGenKey** requires an AT\_KEYEXCHANGE algorithm identifier passed in the *Algid* parameter.

**To generate an RSA/Schannel public/private key pair**

1.  Call the [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) function to get a handle to the [Microsoft RSA/Schannel Cryptographic Provider](microsoft-rsa-schannel-cryptographic-provider.md).
2.  Call the [**CryptGenKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgenkey) function to generate the keys. AT\_KEYEXCHANGE must be passed in for the *Algid* parameter, and the upper 16 bits of the *dwFlags* parameter must be set to the desired key size (512 bits). An [**HCRYPTKEY**](hcryptkey.md) structure handle is returned in the *hKey* parameter.

**To retrieve a pointer to previously generated RSA/Schannel user keys**

1.  Call the [**CryptAcquireContext**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptacquirecontexta) function to get a handle to the [Microsoft RSA/Schannel Cryptographic Provider](microsoft-rsa-schannel-cryptographic-provider.md).
2.  Call the [**CryptGetUserKey**](/windows/desktop/api/Wincrypt/nf-wincrypt-cryptgetuserkey) function, with the *dwKeySpec* parameter set to AT\_KEYEXCHANGE.

## Exporting RSA/Schannel Keys

[*Master keys*](../secgloss/m-gly.md) can be exported into simple key BLOB structures. This should be implemented the same way as the export of normal [*RC4*](../secgloss/r-gly.md) or [*Data Encryption Standard*](../secgloss/d-gly.md) (DES) [*bulk encryption keys*](../secgloss/b-gly.md), as described in [Simple Key BLOB](https://www.bing.com/search?q=Simple+Key+BLOB). The **aiKeyAlg** member of the [**PUBLICKEYSTRUC**](/windows/desktop/api/Wincrypt/ns-wincrypt-publickeystruc) structure is set to the algorithm identifier of the master key (CALG\_PCT1\_MASTER, CALG\_SSL2\_MASTER, CALG\_SSL3\_MASTER, or CALG\_TLS1\_MASTER).

If the [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**) function is exporting an SSL2 master key and the CRYPT\_SSL2\_FALLBACK flag is set, then, to help prevent version rollback attacks, set the first eight bytes of the encryption block [*padding*](../secgloss/p-gly.md) to 0x03 rather than to random data.

If the **CRYPT\_DESTROYKEY** constant is specified in the *dwFlags* parameter of the [**CPExportKey**](https://www.bing.com/search?q=**CPExportKey**) function, the CSP destroys the key or key handle after exporting the key. This flag is intended for use only with [*opaque BLOBs*](../secgloss/o-gly.md).

 

 
