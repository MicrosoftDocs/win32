---
description: Flags that control the calling function's behavior. Used by SHCreateThread and SHCreateThreadWithHandle. In those functions, these values are defined as being of type SHCT\_FLAGS.
title: CTF Flags (Shlwapi.h)
ms.topic: reference
ms.date: 05/31/2018
ms.assetid: 66cda866-7a39-4c5a-a795-a4c5c64cbab7
api_name: 
 - CTF_INSIST
 - CTF_THREAD_REF
 - CTF_PROCESS_REF
 - CTF_COINIT_STA
 - CTF_COINIT
 - CTF_FREELIBANDEXIT
 - CTF_REF_COUNTED
 - CTF_WAIT_ALLOWCOM
 - CTF_UNUSED
 - CTF_INHERITWOW64
 - CTF_WAIT_NO_REENTRANCY
 - CTF_KEYBOARD_LOCALE
 - CTF_OLEINITIALIZE
 - CTF_COINIT_MTA
 - CTF_NOADDREFLIB
api_type: 
 - HeaderDef
api_location: 
 - Shlwapi.h
topic_type: 
 - APIRef
 - kbSyntax

---

# CTF Flags

Flags that control the calling function's behavior. Used by [**SHCreateThread**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethread) and [**SHCreateThreadWithHandle**](/windows/desktop/api/Shlwapi/nf-shlwapi-shcreatethreadwithhandle). In those functions, these values are defined as being of type SHCT\_FLAGS.



| Constant/value                                                                                                                                                                                                                                             | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| <span id="CTF_INSIST"></span><span id="ctf_insist"></span><dl> <dt>**CTF\_INSIST**</dt> <dt>0x00000001</dt> </dl>                                       | 0x00000001. If the attempt to create the thread with [**CreateThread**](/windows/win32/api/processthreadsapi/nf-processthreadsapi-createthread) fails, setting this flag will cause the function pointed to by *pfnThreadProc* to be called synchronously from the calling thread. This flag can be used only if *pfnCallback* is **NULL**.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_THREAD_REF"></span><span id="ctf_thread_ref"></span><dl> <dt>**CTF\_THREAD\_REF**</dt> <dt>0x00000002</dt> </dl>                          | 0x00000002. Hold a reference to the creating thread for the duration of the call to the function pointed to by *pfnThreadProc*. This reference must have been set with [**SHSetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |
| <span id="CTF_PROCESS_REF"></span><span id="ctf_process_ref"></span><dl> <dt>**CTF\_PROCESS\_REF**</dt> <dt>0x00000004</dt> </dl>                       | 0x00000004. Hold a reference to the Windows Explorer process for the duration of the call to the function pointed to by *pfnThreadProc*. This flag is useful for [Shell extension handlers](handlers.md), which might need to keep the Windows Explorer process from closing prematurely. This action is useful during tasks such as working on a background thread or copying files. For more information, see [**SHGetInstanceExplorer**](/windows/desktop/api/shlobj_core/nf-shlobj_core-shgetinstanceexplorer).<br/>                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_COINIT_STA"></span><span id="ctf_coinit_sta"></span><dl> <dt>**CTF\_COINIT\_STA**</dt> <dt>0x00000008</dt> </dl>                          | 0x00000008. Initialize COM as a Single Threaded Apartment (STA) for the created thread before calling either the optional function pointed to by *pfnCallback* or the function pointed to by *pfnThreadProc*. This flag is useful when COM needs to be initialized for a thread. COM will automatically be uninitialized as well.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| <span id="CTF_COINIT"></span><span id="ctf_coinit"></span><dl> <dt>**CTF\_COINIT**</dt> <dt>0x00000008</dt> </dl>                                       | Equivalent to CTF\_COINIT\_STA.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| <span id="CTF_FREELIBANDEXIT"></span><span id="ctf_freelibandexit"></span><dl> <dt>**CTF\_FREELIBANDEXIT**</dt> <dt>0x00000010</dt> </dl>               | 0x00000010. **Internet Explorer 6 or later.**[**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya) will be called on the DLL that contains the *pfnThreadProc* function to prevent it from being unloaded. After *pfnThreadProc* returns, the DLL will be freed with [**FreeLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibrary), thereby decrementing the DLL reference count. Pass this flag to prevent the DLL from being unloaded prematurely; for example, by [**CoFreeUnusedLibraries**](/windows/win32/api/combaseapi/nf-combaseapi-cofreeunusedlibraries). Note that if this flag is passed, the *pfnThreadProc* function must reside in a DLL. This flag is implicit in Windows Vista and later.<br/>                                                                                                                                                                                                                                                                   |
| <span id="CTF_REF_COUNTED"></span><span id="ctf_ref_counted"></span><dl> <dt>**CTF\_REF\_COUNTED**</dt> <dt>0x00000020</dt> </dl>                       | 0x00000020. **Internet Explorer 6 or later.** A thread reference will automatically be created for the created thread and set with [**SHSetThreadRef**](/windows/desktop/api/Shlwapi/nf-shlwapi-shsetthreadref). After the *pfnThreadProc* returns, the thread reference is released and messages are sent until the reference count on the thread reference drops to zero, that is, until threads that are dependent on the created thread have released their references.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_WAIT_ALLOWCOM"></span><span id="ctf_wait_allowcom"></span><dl> <dt>**CTF\_WAIT\_ALLOWCOM**</dt> <dt>0x00000040</dt> </dl>                 | 0x00000040. **Internet Explorer 6 or later.** The calling thread waits and pumps COM and [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) messages. If the synchronous procedure attempts to send a Windows message with **SendMessage** to a window hosted on the calling thread, the message will arrive successfully. If the synchronous procedure attempts to use COM to communicate with an STA object hosted on the calling thread, the function call will successfully reach the intended object. The calling thread is open to re-entrance fragility. While the calling thread can handle the synchronous procedure's use of **SendMessage** and COM, if other threads are using **SendMessage** or COM to communicate to objects hosted on the calling thread, then these might be unexpected messages or function calls which are processed while the synchronous procedure is completing.<br/> |
| <span id="CTF_UNUSED"></span><span id="ctf_unused"></span><dl> <dt>**CTF\_UNUSED**</dt> <dt>0x00000080</dt> </dl>                                       | 0x00000080. **Internet Explorer 7 or later.** Not used.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| <span id="CTF_INHERITWOW64"></span><span id="ctf_inheritwow64"></span><dl> <dt>**CTF\_INHERITWOW64**</dt> <dt>0x00000100</dt> </dl>                     | 0x00000100. **Internet Explorer 7 or later.** The new thread inherits the Windows-on-Windows 64-bit (WOW64) disable state for the file system redirector.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_WAIT_NO_REENTRANCY"></span><span id="ctf_wait_no_reentrancy"></span><dl> <dt>**CTF\_WAIT\_NO\_REENTRANCY**</dt> <dt>0x00000200</dt> </dl> | 0x00000200. **Windows Vista or later.** The calling thread blocks all other processes while waiting for the synchronous procedure to run on the new thread. If the synchronous procedure attempts to send a Windows message with [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) to a window hosted on the calling thread, this causes the synchronous procedure to deadlock. If the synchronous procedure attempts to use COM to talk to an STA object hosted on the calling thread, this also causes the synchronous procedure to deadlock. The calling thread is protected from all re-entrance concerns by specifying this flag.<br/>                                                                                                                                                                                                                                                                |
| <span id="CTF_KEYBOARD_LOCALE"></span><span id="ctf_keyboard_locale"></span><dl> <dt>**CTF\_KEYBOARD\_LOCALE**</dt> <dt>0x00000400</dt> </dl>           | 0x00000400. **Windows 7 or later.** Use the keyboard locale from the original thread in the new thread that it spawns.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| <span id="CTF_OLEINITIALIZE"></span><span id="ctf_oleinitialize"></span><dl> <dt>**CTF\_OLEINITIALIZE**</dt> <dt>0x00000800</dt> </dl>                  | 0x00000800. **Windows 7 or later.** Initialize COM with the single-threaded apartment (STA) model for the created thread.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| <span id="CTF_COINIT_MTA"></span><span id="ctf_coinit_mta"></span><dl> <dt>**CTF\_COINIT\_MTA**</dt> <dt>0x00001000</dt> </dl>                          | 0x00001000. **Windows 7 and later**. Initialize COM with the multithreaded apartment (MTA) model for the created thread.<br/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| <span id="CTF_NOADDREFLIB"></span><span id="ctf_noaddreflib"></span><dl> <dt>**CTF\_NOADDREFLIB**</dt> <dt>0x00002000</dt> </dl>                        | 0x00002000. **Windows 7 or later.** This flag is essentially the opposite of CTF\_FREELIBANDEXIT. This avoids [**LoadLibrary**](/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya)/[**FreeLibraryAndExitThread**](/windows/win32/api/libloaderapi/nf-libloaderapi-freelibraryandexitthread) calls that can result in contention for the loader lock. Use CTF\_NOADDREFLIB only when the new thread has means to ensure that the code of the original thread procedure will remain loaded. This value should not be used in the context of COM objects, because COM objects must ensure that the DLL stays loaded (normally, COM unloads the DLLs).<br/>                                                                                                                                                                                                                                                                                                                    |



## Remarks

If no CTF\_WAIT\_ flag is specified, the calling thread will wait and send [**SendMessage**](/windows/win32/api/winuser/nf-winuser-sendmessage) messages. If the synchronous procedure attempts to send a Windows message with **SendMessage** to a window hosted on the calling thread, the message will get to the intended window. If the synchronous procedure attempts to use COM to talk to an STA object hosted on the calling thread, the synchronous procedure will deadlock. The calling thread is open to re-entrance fragility. While the calling thread can handle the synchronous procedure's use of **SendMessage**, if other threads use **SendMessage** to communicate to an window hosted on the calling thread, then these messages might be unexpected. This can cause them to be processed while the synchronous procedure is completing.

## Requirements



| Requirement | Value |
|-------------------------------------|--------------------------------------------------------------------------------------|
| Minimum supported client<br/> | Windows 2000 Professional, Windows XP, Windows 7 \[desktop apps only\]<br/>    |
| Minimum supported server<br/> | Windows 2000 Server \[desktop apps only\]<br/>                                 |
| Header<br/>                   | <dl> <dt>Shlwapi.h</dt> </dl> |



 

 
